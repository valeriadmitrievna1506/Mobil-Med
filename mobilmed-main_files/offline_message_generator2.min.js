!function(e,t){for(var i in t)e[i]=t[i]}(this,function(e){function t(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return e[s].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){Comagic.UI.registerViewController("offline_message_generator",function(e,t){var i=Comagic.UI.createWidget("offline_message_generator",{settings:e,template:t.offline_message_generator,id:e.id,_submittedCls:"comagic-offline-message-generator--submitted",_errorFieldCls:"comagic-offline-message-generator__field--error",_errorInputFieldCls:"comagic-offline-message-generator__field--error__input",_DELAY_POPUP_ANIMATION:3300,_DELAY_HIDING_ANIMATION:300,render:function(){var t,s,o=this;return e.is_image&&!this.imgLoaded?void this._onImageLoad(e.image_url,this.render,this):(this.constructor.prototype.render.apply(this,arguments),this._setPosition(),this.getEl(".comagic-offline-message-generator__close-btn").addEventListener("click",function(){i.isSubmitted()||i.cancel(),i.destroy()}),this.getEl(".comagic-offline-message-generator__main-btn").addEventListener("click",function(){!o.isSubmitted()&&o._isValid()&&o.submit(o.getValues())}),this._iterFields(function(e,t){var i=this,s=function(e,t){return function(){i._clearField(e,t)}};t&&t.addEventListener("focus",s(e,t))},this),t=this.getEl(".comagic-offline-message-generator__field-group"),t&&(s=t.querySelector("select"),s.addEventListener("change",function(){o._clearField(t)}),s.addEventListener("focus",function(){o._clearField(t)})),void this._initPopup())},_initPopup:function(){this._popup=this.getEl(".comagic-offline-message-generator__submit-popup"),this._popupSubmitInfoTitle=this.getEl(".comagic-offline-message-generator__submit-popup__title"),this._popupSubmitInfoMessage=this.getEl(".comagic-offline-message-generator__submit-popup__message")},_showPopupSubmitInfo:function(e){this._popupSubmitInfoTitle.innerHTML=e.info.title,this._popupSubmitInfoMessage.innerHTML=e.info.message,this._popup.classList.add(e.success?"comagic-offline-message-generator__submit-popup--success":"comagic-offline-message-generator__submit-popup--failure"),this._popup.classList.remove("comagic-offline-message-generator__submit-popup--hidden")},_onImageLoad:function(e,t,i){var s=document.createElement("IMG"),o=function(){i.imgLoaded=!0,t.apply(i)};s.addEventListener("load",o),s.addEventListener("error",o),s.src=e},_setPosition:function(){var t=this.getEl(),i=t.querySelector(".comagic-offline-message-generator");setTimeout(function(){i.classList.add("comagic-offline-message-generator--shown")},10),this._centered="center"==e.v_position&&"middle"==e.h_position},_iterFields:function(e,t){[].slice.apply(this.getEl().querySelectorAll(".comagic-offline-message-generator__field")).forEach(function(i){e.call(t||this,i,i&&i.querySelector(".comagic-offline-message-generator__field__input"))})},_isValid:function(){var e=this,t=this.getErrors()||{},i=!0;return this._iterFields(function(s,o){var r=t[o.getAttribute("c-name")];r&&(i=!1,e._setElError(s,e._errorFieldCls,r),e._setElError(o,e._errorInputFieldCls,r))},this),i},_setElError:function(e,t,i){e.classList.add(t),e.classList.add(t+"--"+i)},_clearField:function(e,t){e&&this._clearEl(e,this._errorFieldCls),t&&this._clearEl(t,this._errorInputFieldCls)},_clearEl:function(e,t){var i;i=[].slice.apply(e.classList).filter(function(e){return e==t||0==e.indexOf(t+"--")}),i.forEach(function(t){e.classList.remove(t)})},destroy:function(){var e=this,t=this.getEl(),i=t.querySelector(".comagic-offline-message-generator"),s=0;this.isSubmitted()?s=this._DELAY_POPUP_ANIMATION:this._centered||(s=this._DELAY_HIDING_ANIMATION),i.classList.remove("comagic-offline-message-generator--shown"),setTimeout(function(){e.constructor.prototype.destroy.apply(e,arguments)},s)},submit:function(){this.getEl(".comagic-offline-message-generator").classList.add(this._submittedCls),this.constructor.prototype.submit.apply(this,arguments)}});i.render(),i.on("leadhide",function(){i.destroy()}),i.on("leadsubmit",function(e){i._showPopupSubmitInfo(e),i.destroy()})})}]));